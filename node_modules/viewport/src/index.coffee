path           = require 'path'

ViewportProxy  = require './viewport_proxy'
viewportProxy  = new ViewportProxy

RequirePackage = require 'require-package'
requirePackage = new RequirePackage

module.exports = viewport = 

    #
    # ### viewport.mount( conf )
    # 
    # Required Config:
    # 
    # `conf.app` - in instance of express app server (or similar)
    # 

    mount: (conf) -> 

        #
        # will serve clientside scripts at '/viewport/*'
        #

        conf.name = 'viewport'

        conf.src = path.join __dirname, '../lib'
        conf.scripts = [
            'main.js',
            'viewport.js',
            'uplink.js',
            'controls.js',
            'view.js',
            'input/keyboard.js',
            'input/mouse.js'
        ]
        requirePackage.mount conf

        #
        # bind to connecting sockets.io
        #

        conf.sockets.on 'connection', (socket) -> viewport.bind socket



    bind: (socket) -> 

        viewportProxy.bind socket
