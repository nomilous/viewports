module.exports = class ViewportProxy

    constructor: (@sockets) -> 

        @viewports = {}

        @sockets.on 'connection', (socket) =>

            socket.on 'viewport:connect', (data) =>

                @handleConnect socket, data

            socket.on 'viewport:reconnect', (data) =>

                @handleConnect socket, data


    handleConnect: (socket, data) -> 

        console.log data

        name      = data.name
        sessionid = data.sessionid

        if @viewports[name]

            #
            # already know this viewport group name
            # 

            primary = @viewports[name]['primary'] == sessionid

            return socket.emit 'viewport:config', 
                
                primary: primary

        #
        # new viewport group (first viewport becomes primary)
        #

        @viewports[name] = primary: sessionid

        socket.emit 'viewport:config', 
                
            primary: true


