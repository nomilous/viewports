require('nez').realize 'Uplink', (Uplink, test, context) -> 

    context 'on connect', (it) ->

        it 'sends viewport:connect on first connect', (done) ->

            Uplink.connected.should.equal false
            Uplink.handle 'NAME',
                on: (e, cb) -> cb()
                emit: (event) -> 
                    Uplink.connected.should.equal true
                    event.should.equal 'viewport:connect'
                    test done

        it 'sends viewport:reconnect on subsequent connect', (done) -> 

            Uplink.connected.should.equal true
            Uplink.handle 'NAME', 
                on: (e, cb) -> cb()
                emit: (event) -> 
                    event.should.equal 'viewport:reconnect'
                    test done


        it 'sends name of viewport on connect', (done) -> 

            Uplink.handle 'NAME', 
                on: (e, cb) -> cb()
                emit: (event, data) ->
                    data.should.eql name: 'NAME'
                    test done